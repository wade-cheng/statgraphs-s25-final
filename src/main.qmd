---
title: "Baseball Analysis"
format: html
output-file: "index.html"
authors:
# https://quarto.org/docs/journals/authors.html#author-schema
# if you want to be fancy with it
  - name: Elina Lee
  - name: Wade Cheng 
  - name: Jaihao Wu
  - name: Leo Yao
---

```{r, include=FALSE}
library(tidyverse)
baseball <- read_csv("train.csv", col_types="iDfffcciiffffffiiiidddddf")
lockBinding("baseball", globalenv()) # make baseball immutable
```

## Introduction

Yap yap yap. Describe/contextualize the data.

Describe the main research questions of the project.

## Results

### Bearing

Ball bearing is correlated with player handedness.

```{r, echo=FALSE}
# mar
# A numerical vector of the form c(bottom, left, top, right) which gives the number of lines of margin to be specified on the four sides of the plot. The default is c(5, 4, 4, 2) + 0.1.
par(mfrow = c(1, 2), mar=c(6,1,4,1))
batter = table(baseball$bearing, baseball$is_batter_lefty)
dimnames(batter) <- list(
  c("left", "center", "right"),
  c("right \nhanded","left \nhanded")
) 

mosaicplot(
  batter, 
  shade=TRUE, 
  las=1,
  main="Batter handedness vs bearing"
  #ylab=c("test","test2","dsf")
)
# text( .2,.6, "TEMP GRAHHHHHHHH",col = "black",cex = 0.5) 
rasterImage(png::readPNG("media/Wii_batter_lefth.png"), xleft=0.4, ybottom=0, xright=0.6, ytop=0.4)
rasterImage(png::readPNG("media/Wii_batter_righth.png"), xleft=0.4, ybottom=0.5, xright=0.6, ytop=0.9)

# reverse bearing for better visualization (pitcher's pov is right center left)
rev_bearing = factor(baseball$bearing, levels=c("right", "center", "left"))
pitcher = table(rev_bearing, baseball$is_pitcher_lefty)
dimnames(pitcher) <- list(
  c("right", "center", "left"),
  c("right \nhanded","left \nhanded")
) 
mosaicplot(
  pitcher, 
  shade=TRUE, 
  las=1,
  main="Pitcher handedness vs bearing"
)
rasterImage(png::readPNG("media/Wii_pitcher_lefth.png"), xleft=0.3, ybottom=0.2, xright=0.6, ytop=0.5)
rasterImage(png::readPNG("media/Wii_pitcher_righth.png"), xleft=0.3, ybottom=0.7, xright=0.6, ytop=1)
```


### Inning

Inning affects pitching and batting gameplay.

### Launch angle

Home runs appear in a select portion of angles.

```{r}
pitch_data <- baseball |> 
  filter(!is.na(launch_angle))

home_run_medians <- pitch_data |>
  filter(is_home_run == 1) |>
  summarise(
    median_launch_angle = median(launch_angle, na.rm = TRUE),
    median_pitch_speed = median(pitch_mph, na.rm = TRUE)
  )

ggplot(pitch_data, aes(x = launch_angle, y = pitch_mph, color = as.factor(is_home_run))) +
  geom_point(alpha = 0.4, size = 1.5) +
  scale_color_manual(values = c("0" = "gray", "1" = "red"), 
                     labels = c("No", "Yes")) +
  geom_vline(xintercept = home_run_medians$median_launch_angle, 
             color = "orange", linetype = "solid") +
  geom_hline(yintercept = home_run_medians$median_pitch_speed, 
             color = "blue", linetype = "solid") + 
  annotate("text", 
           x = home_run_medians$median_launch_angle + 2,
           y = max(pitch_data$pitch_mph),
           label = paste("Median Launch Angle:", round(home_run_medians$median_launch_angle, 2)), 
           color = "orange", hjust = 0) + 
  annotate("text", 
           x = min(pitch_data$launch_angle, na.rm = TRUE) + 15,
           y = home_run_medians$median_pitch_speed + 1,
           label = paste("Median Pitch Speed:", round(home_run_medians$median_pitch_speed, 2)), 
           color = "blue", hjust = 0) +
  annotate("text", x = 50, y = 87, label = "Linear Trend", color = "black", hjust = 0) +
  geom_smooth(method = "lm", se = FALSE, color = "black", size = 1.1) +
  labs(
    title = "Launch Angle vs. Pitch Speed by Home Run with Median Line",
    x = "Launch Angle (degrees)",
    y = "Pitch Speed (mph)",
    color = "Is Home Run"
  ) +
  theme_minimal() +
  theme(legend.position = "top")
```



### Hit location

Home runs are consistently hit in specific locations.

## Discussion

Yap about main conclusions.

### Future Work

Yap about potential directions for future work.